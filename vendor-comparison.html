<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendor Comparison Tool - MyBambu</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #718096;
        }

        .tabs {
            display: flex;
            gap: 10px;
            background: white;
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f7fafc;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #4a5568;
        }

        .tab:hover {
            background: #e2e8f0;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .content-box {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .filter-group select, .filter-group input {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .filter-group select:focus, .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 25px;
            color: white;
            text-align: center;
        }

        .stat-card .label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .subvalue {
            font-size: 14px;
            opacity: 0.9;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: #f7fafc;
            color: #2d3748;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            position: sticky;
            top: 0;
        }

        .data-table tbody tr:hover {
            background: #f7fafc;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-uniteller {
            background: #e9d8fd;
            color: #553c9a;
        }

        .badge-transnetwork {
            background: #bee3f8;
            color: #2c5282;
        }

        .badge-moneygram {
            background: #fed7e2;
            color: #97266d;
        }

        .search-info {
            background: #e6fffa;
            border-left: 4px solid #38b2ac;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: #234e52;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #718096;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Vendor Comparison Tool</h1>
            <p class="subtitle">Interactive analysis of remittance vendors, corridors, and destination banks</p>
        </div>

        <div style="background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
            <a href="vendor-trend-analysis.html" style="color: white; text-decoration: none; display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #fc8181 0%, #f56565 100%); padding: 15px; border-radius: 8px;">
                <span style="font-size: 24px;">‚ö†Ô∏è</span>
                <span style="font-weight: 600; font-size: 16px;">CRITICAL TREND ALERT: View 15.8% Market Share Shift from Uniteller to Transnetwork ‚Üí</span>
            </a>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('vendors')">Vendors</button>
            <button class="tab" onclick="switchTab('countries')">Countries / Corridors</button>
            <button class="tab" onclick="switchTab('payers')">Payers / Banks</button>
            <button class="tab" onclick="switchTab('trends')" style="background: linear-gradient(135deg, #fc8181 0%, #f56565 100%); color: white;">‚ö†Ô∏è Trend Analysis</button>
        </div>

        <!-- VENDORS TAB -->
        <div id="vendors-tab" class="tab-content active">
            <div class="content-box">
                <h2 style="color: #2d3748; margin-bottom: 20px;">Vendor Performance Comparison</h2>

                <div class="comparison-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, #764ba2 0%, #9f7aea 100%);">
                        <div class="label">UNITELLER</div>
                        <div class="value" id="uniteller-total">$0</div>
                        <div class="subvalue" id="uniteller-txs">0 transactions</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #4c51bf 100%);">
                        <div class="label">TRANSNETWORK</div>
                        <div class="value" id="transnetwork-total">$0</div>
                        <div class="subvalue" id="transnetwork-txs">0 transactions</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ed64a6 0%, #f687b3 100%);">
                        <div class="label">MONEYGRAM</div>
                        <div class="value" id="moneygram-total">$0</div>
                        <div class="subvalue" id="moneygram-txs">0 transactions</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="vendorChart"></canvas>
                </div>
            </div>
        </div>

        <!-- COUNTRIES TAB -->
        <div id="countries-tab" class="tab-content">
            <div class="content-box">
                <h2 style="color: #2d3748; margin-bottom: 20px;">Corridor Analysis</h2>

                <div class="filters">
                    <div class="filter-group">
                        <label>Filter by Country</label>
                        <select id="country-filter" onchange="filterCountries()">
                            <option value="">All Countries</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Filter by Vendor</label>
                        <select id="country-vendor-filter" onchange="filterCountries()">
                            <option value="">All Vendors</option>
                            <option value="uniteller">Uniteller</option>
                            <option value="transnetwork">Transnetwork</option>
                            <option value="moneygram">Moneygram</option>
                        </select>
                    </div>
                </div>

                <div id="country-results">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Country</th>
                                <th>Total Volume</th>
                                <th>Transactions</th>
                                <th>Uniteller</th>
                                <th>Transnetwork</th>
                                <th>Moneygram</th>
                                <th>Leader</th>
                            </tr>
                        </thead>
                        <tbody id="country-tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PAYERS TAB -->
        <div id="payers-tab" class="tab-content">
            <div class="content-box">
                <h2 style="color: #2d3748; margin-bottom: 20px;">Payer / Destination Bank Analysis</h2>

                <div class="search-info">
                    üí° <strong>224 destination banks</strong> available. Use filters below to search and compare.
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label>Search Payer Name</label>
                        <input type="text" id="payer-search" placeholder="e.g., BANCOPPEL, BANCENTRO..." oninput="filterPayers()">
                    </div>
                    <div class="filter-group">
                        <label>Filter by Country</label>
                        <select id="payer-country-filter" onchange="filterPayers()">
                            <option value="">All Countries</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Filter by Vendor</label>
                        <select id="payer-vendor-filter" onchange="filterPayers()">
                            <option value="">All Vendors</option>
                            <option value="uniteller">Uniteller Only</option>
                            <option value="transnetwork">Transnetwork Only</option>
                            <option value="moneygram">Moneygram Only</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Sort By</label>
                        <select id="payer-sort" onchange="filterPayers()">
                            <option value="volume">Volume (Highest First)</option>
                            <option value="transactions">Transactions (Most First)</option>
                            <option value="name">Name (A-Z)</option>
                        </select>
                    </div>
                </div>

                <div id="payer-results">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Payer / Bank</th>
                                <th>Country</th>
                                <th>Total Volume</th>
                                <th>Transactions</th>
                                <th>Uniteller</th>
                                <th>Transnetwork</th>
                                <th>Moneygram</th>
                            </tr>
                        </thead>
                        <tbody id="payer-tbody">
                        </tbody>
                    </table>
                    <div id="no-results" class="no-results" style="display: none;">
                        No payers match your search criteria
                    </div>
                </div>
            </div>
        </div>

        <!-- TRENDS TAB -->
        <div id="trends-tab" class="tab-content">
            <div class="content-box" style="background: linear-gradient(135deg, #fff5f5 0%, #ffe5e5 100%); border: 2px solid #fc8181;">
                <h2 style="color: #c53030; margin-bottom: 20px;">‚ö†Ô∏è CRITICAL TREND: Major Market Share Shift</h2>

                <div style="background: white; padding: 30px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="font-size: 72px; font-weight: bold; color: #c53030; margin: 20px 0;">-15.8%</div>
                        <p style="font-size: 20px; color: #2d3748;"><strong>Uniteller lost 15.8 percentage points</strong> of market share from September to October</p>
                        <p style="font-size: 18px; color: #718096; margin-top: 10px;">while Transnetwork gained the same amount</p>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
                        <div style="background: linear-gradient(135deg, #764ba2 0%, #9f7aea 100%); color: white; padding: 30px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 10px;">UNITELLER</div>
                            <div style="font-size: 48px; font-weight: bold; margin: 15px 0;">50.7% ‚Üí 35.0%</div>
                            <div style="font-size: 16px; opacity: 0.9;">September ‚Üí October</div>
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.3); font-size: 18px; color: #feb2b2; font-weight: 600;">
                                ‚Üì 15.8 points
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #4c51bf 100%); color: white; padding: 30px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 14px; opacity: 0.9; margin-bottom: 10px;">TRANSNETWORK</div>
                            <div style="font-size: 48px; font-weight: bold; margin: 15px 0;">49.3% ‚Üí 65.0%</div>
                            <div style="font-size: 16px; opacity: 0.9;">September ‚Üí October</div>
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.3); font-size: 18px; color: #9ae6b4; font-weight: 600;">
                                ‚Üë 15.8 points
                            </div>
                        </div>
                    </div>
                </div>

                <div style="background: white; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">üìä Volume Impact</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Vendor</th>
                                <th>September 2025</th>
                                <th>October 2025 (Projected)</th>
                                <th>Change</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Uniteller Transactions</strong></td>
                                <td>48,216</td>
                                <td>30,813</td>
                                <td style="color: #e53e3e; font-weight: 600;">-36.1%</td>
                            </tr>
                            <tr>
                                <td><strong>Uniteller Volume</strong></td>
                                <td>$10,209,689</td>
                                <td>$6,810,893</td>
                                <td style="color: #e53e3e; font-weight: 600;">-33.3%</td>
                            </tr>
                            <tr>
                                <td><strong>Transnetwork Transactions</strong></td>
                                <td>46,797</td>
                                <td>57,343</td>
                                <td style="color: #38a169; font-weight: 600;">+22.5%</td>
                            </tr>
                            <tr>
                                <td><strong>Transnetwork Volume</strong></td>
                                <td>$9,156,133</td>
                                <td>$11,566,893</td>
                                <td style="color: #38a169; font-weight: 600;">+26.3%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="background: #e6fffa; border-left: 4px solid #38a169; padding: 20px; border-radius: 8px;">
                    <h3 style="color: #22543d; margin-bottom: 15px;">üí° Strategic Recommendations</h3>
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0; color: #234e52; line-height: 1.6;">‚Üí <strong>Immediate:</strong> Reduce Uniteller prefunding from $500K to $300-350K. Redeploy $150-200K to Transnetwork.</li>
                        <li style="padding: 8px 0; color: #234e52; line-height: 1.6;">‚Üí <strong>Investigation:</strong> Understand root cause - pricing changes? Service quality? Corridor availability?</li>
                        <li style="padding: 8px 0; color: #234e52; line-height: 1.6;">‚Üí <strong>Monitoring:</strong> Track daily/weekly to see if trend accelerates, stabilizes, or reverses.</li>
                        <li style="padding: 8px 0; color: #234e52; line-height: 1.6;">‚Üí <strong>Vendor relationships:</strong> Discuss trend with both vendors - potential renegotiation opportunities.</li>
                    </ul>
                </div>

                <div style="background: white; padding: 25px; border-radius: 12px; margin-top: 20px;">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">üåé Trend by Country</h3>

                    <div style="position: relative; height: 400px; margin-bottom: 30px;">
                        <canvas id="countryTrendChart"></canvas>
                    </div>

                    <h4 style="color: #2d3748; margin-bottom: 10px;">Country Details (Biggest Declines):</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Country</th>
                                <th>Uniteller Change</th>
                                <th>Transnetwork Change</th>
                                <th>Impact</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Colombia</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-77.2%</td>
                                <td style="color: #38a169; font-weight: 600;">+48.8%</td>
                                <td>üö® Critical</td>
                            </tr>
                            <tr>
                                <td><strong>Nicaragua</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-40.4%</td>
                                <td style="color: #38a169; font-weight: 600;">+21.8%</td>
                                <td>High</td>
                            </tr>
                            <tr>
                                <td><strong>Mexico</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-35.5%</td>
                                <td style="color: #38a169; font-weight: 600;">+12.9%</td>
                                <td>High</td>
                            </tr>
                            <tr>
                                <td><strong>Ecuador</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-35.1%</td>
                                <td style="color: #38a169; font-weight: 600;">+80.4%</td>
                                <td>High</td>
                            </tr>
                            <tr>
                                <td><strong>Honduras</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-32.1%</td>
                                <td style="color: #38a169; font-weight: 600;">+22.1%</td>
                                <td>High</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="background: white; padding: 25px; border-radius: 12px; margin-top: 20px;">
                    <h3 style="color: #2d3748; margin-bottom: 15px;">üè¶ Top Payer Shifts (Transaction Changes)</h3>

                    <div style="position: relative; height: 500px; margin-bottom: 30px;">
                        <canvas id="payerShiftsChart"></canvas>
                    </div>

                    <h4 style="color: #c53030; margin: 15px 0 10px 0;">Biggest Uniteller Losses:</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Country</th>
                                <th>Payer</th>
                                <th>Transaction Loss</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Colombia</td>
                                <td><strong>Bancolombia</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-3,031 txs</td>
                            </tr>
                            <tr>
                                <td>Nicaragua</td>
                                <td><strong>BANCENTRO</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-2,464 txs</td>
                            </tr>
                            <tr>
                                <td>Mexico</td>
                                <td><strong>BanCoppel</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-2,430 txs</td>
                            </tr>
                            <tr>
                                <td>Honduras</td>
                                <td><strong>Banco Atlantida</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-2,234 txs</td>
                            </tr>
                            <tr>
                                <td>Ecuador</td>
                                <td><strong>Banco Guayaquil</strong></td>
                                <td style="color: #e53e3e; font-weight: 600;">-1,296 txs</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4 style="color: #2f855a; margin: 25px 0 10px 0;">Biggest Transnetwork Gains:</h4>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Country</th>
                                <th>Payer</th>
                                <th>Transaction Gain</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Colombia</td>
                                <td><strong>BANCOLOMBIA</strong></td>
                                <td style="color: #38a169; font-weight: 600;">+2,321 txs</td>
                            </tr>
                            <tr>
                                <td>Honduras</td>
                                <td><strong>BANCO ATLANTIDA</strong></td>
                                <td style="color: #38a169; font-weight: 600;">+2,049 txs</td>
                            </tr>
                            <tr>
                                <td>Nicaragua</td>
                                <td><strong>BANCENTRO</strong></td>
                                <td style="color: #38a169; font-weight: 600;">+1,951 txs</td>
                            </tr>
                            <tr>
                                <td>Mexico</td>
                                <td><strong>BANCOPPEL</strong></td>
                                <td style="color: #38a169; font-weight: 600;">+1,737 txs</td>
                            </tr>
                            <tr>
                                <td>Ecuador</td>
                                <td><strong>BANCO DE GUAYAQUIL</strong></td>
                                <td style="color: #38a169; font-weight: 600;">+694 txs</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="background: #fffaf0; border-left: 4px solid #ed8936; padding: 20px; border-radius: 8px; margin-top: 20px;">
                    <h3 style="color: #c05621; margin-bottom: 10px;">üîç Key Finding</h3>
                    <p style="color: #7c2d12; line-height: 1.6;"><strong>Same payers are involved in both losses and gains!</strong> This confirms customers are actively <strong>switching from Uniteller to Transnetwork</strong> for the same destination banks. Not just market expansion - this is direct vendor substitution.</p>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <a href="vendor-trend-analysis.html" style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 16px;">
                        View Full Trend Analysis with Charts ‚Üí
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // This will be populated from the JSON file
        let payerData = [];

        // Country names mapping
        const countryNames = {
            'MX': 'Mexico', 'HN': 'Honduras', 'NI': 'Nicaragua', 'CO': 'Colombia',
            'EC': 'Ecuador', 'GT': 'Guatemala', 'VE': 'Venezuela', 'SV': 'El Salvador',
            'DO': 'Dominican Republic', 'CR': 'Costa Rica', 'HT': 'Haiti', 'PE': 'Peru',
            'PA': 'Panama', 'BO': 'Bolivia', 'BR': 'Brazil', 'CL': 'Chile', 'PY': 'Paraguay',
            'UY': 'Uruguay', 'AR': 'Argentina'
        };

        // Load payer data
        async function loadData() {
            try {
                const response = await fetch('payer_data.json');
                payerData = await response.json();
                initializeApp();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function initializeApp() {
            calculateVendorTotals();
            populateCountryDropdowns();
            filterCountries();
            filterPayers();
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function calculateVendorTotals() {
            let unitellerTotal = 0, unitellerTxs = 0;
            let transnetworkTotal = 0, transnetworkTxs = 0;
            let moneygramTotal = 0, moneygramTxs = 0;

            payerData.forEach(payer => {
                unitellerTotal += payer.uniteller.amount;
                unitellerTxs += payer.uniteller.txCount;
                transnetworkTotal += payer.transnetwork.amount;
                transnetworkTxs += payer.transnetwork.txCount;
                moneygramTotal += payer.moneygram.amount;
                moneygramTxs += payer.moneygram.txCount;
            });

            document.getElementById('uniteller-total').textContent = '$' + (unitellerTotal / 1000).toFixed(0) + 'K';
            document.getElementById('uniteller-txs').textContent = unitellerTxs.toLocaleString() + ' transactions';
            document.getElementById('transnetwork-total').textContent = '$' + (transnetworkTotal / 1000).toFixed(0) + 'K';
            document.getElementById('transnetwork-txs').textContent = transnetworkTxs.toLocaleString() + ' transactions';
            document.getElementById('moneygram-total').textContent = '$' + (moneygramTotal / 1000).toFixed(0) + 'K';
            document.getElementById('moneygram-txs').textContent = moneygramTxs.toLocaleString() + ' transactions';

            // Create vendor chart
            const ctx = document.getElementById('vendorChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Volume ($M)', 'Transactions (K)', 'Market Share (%)'],
                    datasets: [
                        {
                            label: 'Uniteller',
                            data: [
                                (unitellerTotal / 1000000).toFixed(2),
                                (unitellerTxs / 1000).toFixed(1),
                                ((unitellerTotal / (unitellerTotal + transnetworkTotal + moneygramTotal)) * 100).toFixed(1)
                            ],
                            backgroundColor: 'rgba(118, 75, 162, 0.8)'
                        },
                        {
                            label: 'Transnetwork',
                            data: [
                                (transnetworkTotal / 1000000).toFixed(2),
                                (transnetworkTxs / 1000).toFixed(1),
                                ((transnetworkTotal / (unitellerTotal + transnetworkTotal + moneygramTotal)) * 100).toFixed(1)
                            ],
                            backgroundColor: 'rgba(102, 126, 234, 0.8)'
                        },
                        {
                            label: 'Moneygram',
                            data: [
                                (moneygramTotal / 1000000).toFixed(2),
                                (moneygramTxs / 1000).toFixed(1),
                                ((moneygramTotal / (unitellerTotal + transnetworkTotal + moneygramTotal)) * 100).toFixed(1)
                            ],
                            backgroundColor: 'rgba(237, 100, 166, 0.8)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        title: { display: true, text: 'Vendor Comparison Metrics' }
                    }
                }
            });
        }

        function populateCountryDropdowns() {
            const countries = [...new Set(payerData.map(p => p.country))].sort();

            const countryFilter = document.getElementById('country-filter');
            const payerCountryFilter = document.getElementById('payer-country-filter');

            countries.forEach(code => {
                const option1 = document.createElement('option');
                option1.value = code;
                option1.textContent = countryNames[code] || code;
                countryFilter.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = code;
                option2.textContent = countryNames[code] || code;
                payerCountryFilter.appendChild(option2);
            });
        }

        function filterCountries() {
            const countryFilter = document.getElementById('country-filter').value;
            const vendorFilter = document.getElementById('country-vendor-filter').value;

            // Aggregate by country
            const countryMap = {};
            payerData.forEach(payer => {
                if (!countryMap[payer.country]) {
                    countryMap[payer.country] = {
                        uniteller: { amount: 0, txCount: 0 },
                        transnetwork: { amount: 0, txCount: 0 },
                        moneygram: { amount: 0, txCount: 0 },
                        total: 0,
                        totalTx: 0
                    };
                }
                countryMap[payer.country].uniteller.amount += payer.uniteller.amount;
                countryMap[payer.country].uniteller.txCount += payer.uniteller.txCount;
                countryMap[payer.country].transnetwork.amount += payer.transnetwork.amount;
                countryMap[payer.country].transnetwork.txCount += payer.transnetwork.txCount;
                countryMap[payer.country].moneygram.amount += payer.moneygram.amount;
                countryMap[payer.country].moneygram.txCount += payer.moneygram.txCount;
                countryMap[payer.country].total += payer.total;
                countryMap[payer.country].totalTx += payer.totalTx;
            });

            let countries = Object.entries(countryMap).map(([code, data]) => ({
                code,
                name: countryNames[code] || code,
                ...data
            }));

            // Apply filters
            if (countryFilter) {
                countries = countries.filter(c => c.code === countryFilter);
            }
            if (vendorFilter) {
                countries = countries.filter(c => c[vendorFilter].amount > 0);
            }

            // Sort by total volume
            countries.sort((a, b) => b.total - a.total);

            // Populate table
            const tbody = document.getElementById('country-tbody');
            tbody.innerHTML = '';
            countries.forEach((country, index) => {
                const leader = country.uniteller.amount > country.transnetwork.amount && country.uniteller.amount > country.moneygram.amount ? 'Uniteller' :
                              country.transnetwork.amount > country.moneygram.amount ? 'Transnetwork' : 'Moneygram';

                const row = `
                    <tr>
                        <td><strong>#${index + 1}</strong></td>
                        <td><strong>${country.name}</strong></td>
                        <td><strong>$${(country.total / 1000).toFixed(0)}K</strong></td>
                        <td>${country.totalTx.toLocaleString()}</td>
                        <td>${country.uniteller.amount > 0 ? '$' + (country.uniteller.amount / 1000).toFixed(0) + 'K' : '‚Äî'}</td>
                        <td>${country.transnetwork.amount > 0 ? '$' + (country.transnetwork.amount / 1000).toFixed(0) + 'K' : '‚Äî'}</td>
                        <td>${country.moneygram.amount > 0 ? '$' + (country.moneygram.amount / 1000).toFixed(0) + 'K' : '‚Äî'}</td>
                        <td><span class="badge badge-${leader.toLowerCase()}">${leader}</span></td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function filterPayers() {
            const search = document.getElementById('payer-search').value.toLowerCase();
            const countryFilter = document.getElementById('payer-country-filter').value;
            const vendorFilter = document.getElementById('payer-vendor-filter').value;
            const sortBy = document.getElementById('payer-sort').value;

            let filtered = payerData.filter(payer => {
                if (search && !payer.payer.toLowerCase().includes(search)) return false;
                if (countryFilter && payer.country !== countryFilter) return false;
                if (vendorFilter === 'uniteller' && payer.uniteller.amount === 0) return false;
                if (vendorFilter === 'transnetwork' && payer.transnetwork.amount === 0) return false;
                if (vendorFilter === 'moneygram' && payer.moneygram.amount === 0) return false;
                return true;
            });

            // Sort
            if (sortBy === 'volume') {
                filtered.sort((a, b) => b.total - a.total);
            } else if (sortBy === 'transactions') {
                filtered.sort((a, b) => b.totalTx - a.totalTx);
            } else if (sortBy === 'name') {
                filtered.sort((a, b) => a.payer.localeCompare(b.payer));
            }

            const tbody = document.getElementById('payer-tbody');
            const noResults = document.getElementById('no-results');

            if (filtered.length === 0) {
                tbody.innerHTML = '';
                noResults.style.display = 'block';
                return;
            }

            noResults.style.display = 'none';
            tbody.innerHTML = '';
            filtered.forEach((payer, index) => {
                const row = `
                    <tr>
                        <td><strong>#${index + 1}</strong></td>
                        <td><strong>${payer.payer}</strong></td>
                        <td>${countryNames[payer.country] || payer.country}</td>
                        <td><strong>$${(payer.total / 1000).toFixed(0)}K</strong></td>
                        <td>${payer.totalTx.toLocaleString()}</td>
                        <td>${payer.uniteller.amount > 0 ? '$' + (payer.uniteller.amount / 1000).toFixed(0) + 'K (' + payer.uniteller.txCount + ' txs)' : '‚Äî'}</td>
                        <td>${payer.transnetwork.amount > 0 ? '$' + (payer.transnetwork.amount / 1000).toFixed(0) + 'K (' + payer.transnetwork.txCount + ' txs)' : '‚Äî'}</td>
                        <td>${payer.moneygram.amount > 0 ? '$' + (payer.moneygram.amount / 1000).toFixed(0) + 'K (' + payer.moneygram.txCount + ' txs)' : '‚Äî'}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Trend Analysis Charts
        function createTrendCharts() {
            // Country Trend Chart
            const countryCtx = document.getElementById('countryTrendChart');
            if (countryCtx) {
                new Chart(countryCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Colombia', 'Nicaragua', 'Mexico', 'Ecuador', 'Honduras'],
                        datasets: [
                            {
                                label: 'Uniteller Change',
                                data: [-77.2, -40.4, -35.5, -35.1, -32.1],
                                backgroundColor: 'rgba(229, 62, 62, 0.8)',
                                borderColor: 'rgb(229, 62, 62)',
                                borderWidth: 2
                            },
                            {
                                label: 'Transnetwork Change',
                                data: [48.8, 21.8, 12.9, 80.4, 22.1],
                                backgroundColor: 'rgba(56, 161, 105, 0.8)',
                                borderColor: 'rgb(56, 161, 105)',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: {
                                display: true,
                                text: 'Vendor Performance Change by Country (Sept ‚Üí Oct Projected %)',
                                font: { size: 14, weight: 'bold' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                title: {
                                    display: true,
                                    text: 'Change (%)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Payer Shifts Chart - Horizontal bar showing losses vs gains
            const payerCtx = document.getElementById('payerShiftsChart');
            if (payerCtx) {
                new Chart(payerCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [
                            'Bancolombia (CO)',
                            'BANCENTRO (NI)',
                            'BanCoppel (MX)',
                            'Banco Atlantida (HN)',
                            'Banco Guayaquil (EC)'
                        ],
                        datasets: [
                            {
                                label: 'Uniteller Loss',
                                data: [-3031, -2464, -2430, -2234, -1296],
                                backgroundColor: 'rgba(229, 62, 62, 0.8)',
                                borderColor: 'rgb(229, 62, 62)',
                                borderWidth: 2
                            },
                            {
                                label: 'Transnetwork Gain',
                                data: [2321, 1951, 1737, 2049, 694],
                                backgroundColor: 'rgba(56, 161, 105, 0.8)',
                                borderColor: 'rgb(56, 161, 105)',
                                borderWidth: 2
                            }
                        ]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: {
                                display: true,
                                text: 'Top 5 Payer Shifts: Uniteller Losses vs Transnetwork Gains (Transactions)',
                                font: { size: 14, weight: 'bold' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = Math.abs(context.parsed.x);
                                        return context.dataset.label + ': ' + value.toLocaleString() + ' txs';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Transaction Change'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        // Initialize on page load
        loadData();

        // Create trend charts after a short delay to ensure DOM is ready
        setTimeout(createTrendCharts, 500);
    </script>
</body>
</html>
